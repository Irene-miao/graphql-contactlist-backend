(this["webpackJsonpgraphql-frontend-part8"]=this["webpackJsonpgraphql-frontend-part8"]||[]).push([[0],{71:function(e,n,t){},86:function(e,n,t){"use strict";t.r(n);var r,a,c,s,o,i,u,j,l=t(52),b=t(3),d=t(57),O=t.n(d),h=(t(71),t(8)),v=t(95),p=t(96),f=t(105),g=t(89),m=t(22),x=t(101),S=Object(x.a)(r||(r=Object(m.a)(["\n fragment PersonDetails on Person {\n    name\n    phone\n    address {\n        street\n        city\n    }\n}\n "]))),w=Object(x.a)(a||(a=Object(m.a)(["\n {\n  allPersons {\n   ...PersonDetails\n  }\n}\n","\n"])),S),P=Object(x.a)(c||(c=Object(m.a)(["\n query findPersonByName($nameToSearch: String!) {\n    findPerson(name: $nameToSearch) {\n        ...PersonDetails\n        id\n    }\n}\n","\n"])),S),y=Object(x.a)(s||(s=Object(m.a)(["\nmutation createPerson($name: String!, $street: String!, $city: String!, $phone: String) {\n    addPerson(\n        name: $name\n        street: $street\n        city: $city\n        phone: $phone\n    ) {\n       ...PersonDetails\n       id\n    }\n}\n","\n"])),S),C=Object(x.a)(o||(o=Object(m.a)(["\nmutation editNumber($name: String!, $phone: String!) {\n    editNumber(name: $name, phone: $phone) {\n       ...PersonDetails\n        id\n    }\n}\n","\n"])),S),$=Object(x.a)(i||(i=Object(m.a)(["\nmutation login($username: String!, $password: String!){\n    login(username: $username, password: $password){\n        value\n    }\n}\n"]))),E=Object(x.a)(u||(u=Object(m.a)(["\nsubscription {\n    personAdded {\n        ...PersonDetails\n    }\n}\n","\n"])),S),k=Object(x.a)(j||(j=Object(m.a)(["\nmutation createUser($username: String!, $password: String!){\n    createUser(username: $username, password: $password){\n        username\n        password\n        id\n        friends\n    }\n}\n"]))),D=t(2),q=function(e){var n=e.persons,t=e.show,r=e.setError,a=Object(g.a)(P,{onError:function(e){r(e)}}),c=Object(h.a)(a,2),s=c[0],o=c[1],i=Object(b.useState)(null),u=Object(h.a)(i,2),j=u[0],l=u[1];return Object(b.useEffect)((function(){o.data&&l(o.data.findPerson)}),[o]),j?Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:j.name}),Object(D.jsxs)("div",{children:[j.address.street," ",j.address.city]}),Object(D.jsx)("div",{children:j.phone}),Object(D.jsx)("button",{onClick:function(){return l(null)},children:"close"})]}):t?Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:"Persons"}),n.map((function(e){return Object(D.jsxs)("div",{children:[e.name," ",e.phone,Object(D.jsx)("button",{onClick:function(){return n=e.name,void s({variables:{nameToSearch:n}});var n},children:"show address"})]},e.name)}))]}):null},N=t(104),T=function(e){var n=e.setError,t=e.updateCacheWith,r=e.show,a=Object(b.useState)(""),c=Object(h.a)(a,2),s=c[0],o=c[1],i=Object(b.useState)(""),u=Object(h.a)(i,2),j=u[0],l=u[1],d=Object(b.useState)(""),O=Object(h.a)(d,2),v=O[0],p=O[1],f=Object(b.useState)(""),g=Object(h.a)(f,2),m=g[0],x=g[1],S=Object(N.a)(y,{onError:function(e){n(e.graphQLErrors[0].message)},update:function(e,n){t(n.data.addPerson)}}),w=Object(h.a)(S,1)[0];if(!r)return null;return Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:"Create New"}),Object(D.jsxs)("form",{onSubmit:function(e){e.preventDefault(),w({variables:{name:s,street:v,city:m,phone:j.length>0?j:null}}),o(""),l(""),p(""),x("")},children:[Object(D.jsxs)("div",{children:["name ",Object(D.jsx)("input",{value:s,onChange:function(e){var n=e.target;return o(n.value)}})]}),Object(D.jsxs)("div",{children:["phone ",Object(D.jsx)("input",{value:j,onChange:function(e){var n=e.target;return l(n.value)}})]}),Object(D.jsxs)("div",{children:["street ",Object(D.jsx)("input",{value:v,onChange:function(e){var n=e.target;return p(n.value)}})]}),Object(D.jsxs)("div",{children:["city ",Object(D.jsx)("input",{value:m,onChange:function(e){var n=e.target;return x(n.value)}})]}),Object(D.jsx)("button",{type:"submit",children:"add"})]})]})},Q=function(e){var n=e.errorMessage;return n?Object(D.jsx)("div",{style:{color:"red"},children:n}):null},L=function(e){var n=e.setError,t=e.show,r=Object(b.useState)(""),a=Object(h.a)(r,2),c=a[0],s=a[1],o=Object(b.useState)(""),i=Object(h.a)(o,2),u=i[0],j=i[1],l=Object(N.a)(C),d=Object(h.a)(l,2),O=d[0],v=d[1];if(Object(b.useEffect)((function(){v.data&&null===v.data.editNumber&&n("Person not found")}),[v.data]),!t)return null;return Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:"Change Number"}),Object(D.jsxs)("form",{onSubmit:function(e){e.preventDefault(),O({variables:{name:c,phone:u}}),s(""),j("")},children:[Object(D.jsxs)("div",{children:["name ",Object(D.jsx)("input",{value:c,onChange:function(e){var n=e.target;return s(n.value)}})]}),Object(D.jsxs)("div",{children:["phone ",Object(D.jsx)("input",{value:u,onChange:function(e){var n=e.target;return j(n.value)}})]}),Object(D.jsx)("button",{type:"submit",children:"change number"})]})]})},I=t(29),A=t.n(I),B=t(43),J=function(e){var n=e.setError,t=e.setToken,r=e.show,a=Object(b.useState)(""),c=Object(h.a)(a,2),s=c[0],o=c[1],i=Object(b.useState)(""),u=Object(h.a)(i,2),j=u[0],l=u[1],d=Object(N.a)($,{onError:function(e){var t;n(null===(t=e.graphQLErrors[0])||void 0===t?void 0:t.message)}}),O=Object(h.a)(d,2),v=O[0],p=O[1];if(Object(b.useEffect)((function(){if(p.data){var e=p.data.login.value;t(e),localStorage.setItem("phonenumbers-user-token",e)}}),[p.data]),!r)return null;var f=function(){var e=Object(B.a)(A.a.mark((function e(n){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),v({variables:{username:s,password:j}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:"Login"}),Object(D.jsxs)("form",{onSubmit:f,children:[Object(D.jsxs)("div",{children:["username",Object(D.jsx)("input",{value:s,onChange:function(e){var n=e.target;return o(n.value)}})]}),Object(D.jsxs)("div",{children:["password",Object(D.jsx)("input",{value:j,onChange:function(e){var n=e.target;return l(n.value)}})]}),Object(D.jsx)("button",{type:"submit",children:"login"})]})]})},M=function(e){var n=e.setError,t=e.show,r=Object(b.useState)(""),a=Object(h.a)(r,2),c=a[0],s=a[1],o=Object(b.useState)(""),i=Object(h.a)(o,2),u=i[0],j=i[1],l=Object(N.a)(k,{onError:function(e){n(e.graphQLErrors[0].message)}}),d=Object(h.a)(l,1)[0];if(!t)return null;var O=function(){var e=Object(B.a)(A.a.mark((function e(n){return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),d({variables:{username:c,password:u}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return Object(D.jsxs)("div",{children:[Object(D.jsx)("h2",{children:"Register"}),Object(D.jsxs)("form",{onSubmit:O,children:[Object(D.jsxs)("div",{children:["username",Object(D.jsx)("input",{value:c,onChange:function(e){var n=e.target;return s(n.value)}})]}),Object(D.jsxs)("div",{children:["password",Object(D.jsx)("input",{value:u,onChange:function(e){var n=e.target;return j(n.value)}})]}),Object(D.jsx)("button",{type:"submit",children:"login"})]})]})},U=function(){var e,n=Object(b.useState)("login"),t=Object(h.a)(n,2),r=t[0],a=t[1],c=Object(b.useState)(null),s=Object(h.a)(c,2),o=s[0],i=s[1],u=Object(b.useState)(null),j=Object(h.a)(u,2),l=j[0],d=j[1],O=Object(v.a)(w),g=Object(p.a)(),m=function(e){var n,t,r=g.readQuery({query:w});n=r.allPersons,t=e,n.map((function(e){return e.id})).includes(t.id)||g.writeQuery({query:w,data:{allPersons:r.allPersons.concat(e)}})};Object(f.a)(E,{onSubscriptionData:function(e){var n=e.subscriptionData.data.personAdded;x("".concat(n.name," added")),m(n)}});var x=function(e){i(e),setTimeout((function(){i(null)}),1e4)};if(O.loading)return Object(D.jsx)("div",{children:"loading..."});return Object(D.jsxs)("div",{children:[Object(D.jsxs)("div",{children:[Object(D.jsx)("button",{onClick:function(){return a("persons")},children:"persons"}),Object(D.jsx)("button",{onClick:function(){return a("register")},children:"register"}),null===l?Object(D.jsx)("button",{onClick:function(){return a("login")},children:"login"}):Object(D.jsxs)("div",{children:[" ",Object(D.jsx)("button",{onClick:function(){return a("addPerson")},children:"add person"}),Object(D.jsx)("button",{onClick:function(){return a("addPhone")},children:"add phone"}),Object(D.jsx)("button",{onClick:function(){d(null),localStorage.clear(),g.resetStore()},children:"logout"})]})]}),Object(D.jsx)("div",{children:Object(D.jsx)(Q,{errorMessage:o})}),Object(D.jsx)(q,{show:"persons"===r,setError:x,persons:null===(e=O.data)||void 0===e?void 0:e.allPersons}),Object(D.jsx)(T,{show:"addPerson"===r,setError:x,updateCacheWith:m}),Object(D.jsx)(L,{show:"addPhone"===r,setError:x}),Object(D.jsx)(J,{show:"login"===r,setToken:d,setError:x}),Object(D.jsx)(M,{show:"register"===r,setError:x})]})},W=t(100),z=t(97),R=t(99),F=t(102),G=t(98),H=t(63),K=t(24),V=t(61),X=Object(H.a)((function(e,n){var t=n.headers,r=localStorage.getItem("phonenumbers-user-token");return{headers:Object(l.a)(Object(l.a)({},t),{},{authorization:r?"bearer ".concat(r):null})}})),Y=new W.a({uri:"/graphql"}),Z=new V.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0}}),_=Object(z.a)((function(e){var n=e.query,t=Object(K.e)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),Z,X.concat(Y)),ee=new R.a({cache:new F.a,link:_});O.a.render(Object(D.jsx)(G.a,{client:ee,children:Object(D.jsx)(U,{})}),document.getElementById("root"))}},[[86,1,2]]]);
//# sourceMappingURL=main.dda80ed5.chunk.js.map